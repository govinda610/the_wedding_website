<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>The Grapevine - Govind & Samidha's Wedding</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Montserrat:wght@300;400;500;600&family=Dancing+Script:wght@400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        'coral-pink': '#FF9B8A',
                        'salmon-pink': '#FFB5A7',
                        'emerald-green': '#50C878',
                        'sage-green': '#9CAF88',
                        'cream': '#FDF6E3',
                        'champagne': '#F7E7CE',
                        'teal-blue': '#008B8B',
                        'peacock-blue': '#005F69',
                        'terracotta': '#E2725B',
                        'burnt-orange': '#CC5500',
                        'gold': '#FFD700',
                        'warm-brass': '#B5651D',
                    },
                    fontFamily: {
                        'heading': ['Playfair Display', 'serif'],
                        'elegant': ['Cormorant Garamond', 'serif'],
                        'body': ['Montserrat', 'sans-serif'],
                        'script': ['Dancing Script', 'cursive'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            min-height: 100vh;
        }

        /* Botanical pattern */
        .botanical-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2350C878' fill-opacity='0.08'%3E%3Cpath d='M30 30c0-5.523-4.477-10-10-10s-10 4.477-10 10 4.477 10 10 10 10-4.477 10-10zm10 0c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10-10-4.477-10-10z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-40px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        @keyframes heartBeat {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }
        }

        /* Message card styles */
        .message-card {
            transition: all 0.3s ease;
            animation: slideInLeft 0.6s ease-out;
        }

        .message-card:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 25px rgba(0, 95, 105, 0.15);
        }

        /* Scroll reveal */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .scroll-reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>

<body class="bg-cream dark:bg-peacock-blue font-body text-peacock-blue dark:text-champagne">

    <!-- Background layers -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="botanical-pattern absolute inset-0"></div>
        <div class="absolute inset-0 bg-gradient-to-b from-champagne/40 via-transparent to-champagne/40"></div>
    </div>

    <div class="relative flex min-h-screen w-full flex-col">

        <!-- Header -->
        <header
            class="sticky top-0 z-50 backdrop-blur-xl bg-cream/90 dark:bg-peacock-blue/90 border-b-2 border-gold/20 shadow-lg">
            <div class="flex items-center justify-between p-4 max-w-6xl mx-auto">
                <button onclick="window.location.href='index.html'"
                    class="group flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-coral-pink to-salmon-pink text-white hover:from-emerald-green hover:to-teal-blue transition-all duration-300 transform hover:scale-110 shadow-lg">
                    <span class="material-symbols-outlined group-hover:scale-110 transition-transform">arrow_back</span>
                </button>

                <div class="flex-1 text-center">
                    <h1 class="font-heading text-2xl md:text-3xl font-bold text-peacock-blue dark:text-champagne">
                        The Grapevine
                    </h1>
                    <div class="flex justify-center items-center gap-2 mt-1">
                        <div class="w-8 h-0.5 bg-gradient-to-r from-transparent via-gold to-warm-brass"></div>
                        <div class="text-gold text-xs">‚ùñ</div>
                        <div class="w-8 h-0.5 bg-gradient-to-r from-warm-brass via-gold to-transparent"></div>
                    </div>
                </div>

                <div class="w-12 h-12 flex items-center justify-center">
                    <div class="text-3xl animate-[float_3s_ease-in-out_infinite]">üçá</div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="relative flex-grow p-4 md:p-8 pb-24 max-w-6xl mx-auto w-full">

            <!-- Grapevine Section -->
            <section class="mb-12 scroll-reveal">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="text-4xl animate-[float_3s_ease-in-out_infinite]">üçá</div>
                        <div>
                            <h2 class="font-heading text-3xl md:text-4xl font-bold text-peacock-blue dark:text-gold">
                                The Grapevine
                            </h2>
                            <p class="font-elegant text-lg text-peacock-blue/70 dark:text-champagne/70 mt-1">
                                Spill the tea, share the gossip! ‚òï
                            </p>
                        </div>
                    </div>
                </div>

                <div class="bg-white/60 dark:bg-peacock-blue/60 backdrop-blur-md rounded-2xl shadow-xl border-2 border-sage-green/30 flex flex-col"
                    style="height: calc(100vh - 280px); min-height: 400px;">

                    <!-- Sticky Input at TOP for visibility -->
                    <div
                        class="p-4 bg-gradient-to-r from-emerald-green/10 to-teal-blue/10 dark:from-peacock-blue/40 dark:to-teal-blue/20 rounded-t-2xl border-b-2 border-gold/20">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">‚òï</span>
                            <input type="text" id="grapevine-input" placeholder="Spill the tea... What's the gossip?"
                                class="flex-1 border-2 border-champagne dark:border-peacock-blue/50 rounded-full px-5 py-3 font-body text-sm md:text-base bg-white/90 dark:bg-peacock-blue/50 text-peacock-blue dark:text-champagne placeholder:text-peacock-blue/50 dark:placeholder:text-champagne/50 focus:border-emerald-green focus:ring-2 focus:ring-emerald-green/30 transition-all duration-300" />
                            <button onclick="submitGrapevineMessage()"
                                class="group flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-emerald-green to-teal-blue text-white hover:from-gold hover:to-warm-brass shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110">
                                <span
                                    class="material-symbols-outlined group-hover:animate-[heartBeat_0.5s_ease-in-out]">send</span>
                            </button>
                        </div>
                        <p class="text-xs text-peacock-blue/60 dark:text-champagne/60 mt-2 text-center">üëÜ Share your
                            gossip above! üëÜ</p>
                    </div>

                    <!-- Messages Container - scrollable area -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="messages-container">

                        <!-- Sample Message 1 -->
                        <div
                            class="message-card flex items-start gap-4 bg-champagne/40 dark:bg-peacock-blue/40 rounded-xl p-4">
                            <img alt="User avatar" class="h-12 w-12 rounded-full border-2 border-gold shadow-lg"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuBUcvoKwFyBELqVUW4fgZR-p-l54VFa91RoQL9TCcSfxK3gaNlmD8hn0WcZaE3vxZ9SA8pnwWMZfTlyt5PGfny6Ap2mFOnhx8e4XiGTmkkj4njgstZ93C33rTF_zNQ4D3vlVMpSk8Glmm-t7GCzkE0V3teboRcpYCPFiG_6pjocKTwdv5Xu91iS8kpFRwxUqX95YEgiEgVwqYF_YMXTZLbEPTe_w76a5lP9VROt1BxlR1cVtePYLRGdbfwXdXCE_iBTX-Ag1NEH" />
                            <div class="flex-1">
                                <div class="bg-white/80 dark:bg-peacock-blue/80 rounded-xl p-4 shadow-md">
                                    <p class="font-body text-sm md:text-base text-peacock-blue dark:text-champagne">
                                        I heard that the girl was a Brahmin and that it's a love marriage.
                                    </p>
                                </div>
                                <div class="flex items-center gap-2 mt-2">
                                    <span
                                        class="font-elegant text-xs font-semibold text-emerald-green dark:text-sage-green">Aunty
                                        #1</span>
                                    <span class="text-peacock-blue/40 dark:text-champagne/40">‚Ä¢</span>
                                    <span class="font-body text-xs text-peacock-blue/60 dark:text-champagne/60">2 hours
                                        ago</span>
                                </div>
                            </div>
                        </div>

                        <!-- Sample Message 2 -->
                        <div
                            class="message-card flex items-start gap-4 bg-champagne/40 dark:bg-peacock-blue/40 rounded-xl p-4">
                            <img alt="User avatar" class="h-12 w-12 rounded-full border-2 border-gold shadow-lg"
                                src="https://lh3.googleusercontent.com/aida-public/AB6AXuBEiZZ1wKOZALSe2p-m5PEzwOxSpqhoptXzc6Jfm_uCXZ94Iq3g2tIOp1C7eSj8hB-KGxudDyJ5aJucV76Z9_yWOrE0E3Z6dQ9CbdOrBx5djV_Z3nLNCZforouppHM7gqIv-rHqspj8VMNreO6Bo2HGYGUCVTwIVQipzpx1mS88PcYtqzEacTfBjtZWm9-bMmpBx8m40nlC0XLr1oyh5mUy_iwc50pAUEOLI5iLZcMBz4JZ54z3Kc2D-banYFvO4Mt-18QVSK-r" />
                            <div class="flex-1">
                                <div class="bg-white/80 dark:bg-peacock-blue/80 rounded-xl p-4 shadow-md">
                                    <p class="font-body text-sm md:text-base text-peacock-blue dark:text-champagne">
                                        Yeah, yeah, that's true. They have been at it since college. They've had an
                                        affair since college.
                                    </p>
                                </div>
                                <div class="flex items-center gap-2 mt-2">
                                    <span
                                        class="font-elegant text-xs font-semibold text-emerald-green dark:text-sage-green">Aunty
                                        #2</span>
                                    <span class="text-peacock-blue/40 dark:text-champagne/40">‚Ä¢</span>
                                    <span class="font-body text-xs text-peacock-blue/60 dark:text-champagne/60">1 hour
                                        ago</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            <!-- Bottom decorative flourish -->
            <div class="mt-12 flex justify-center gap-4 scroll-reveal">
                <div class="text-3xl animate-[float_3s_ease-in-out_infinite]">üåø</div>
                <div class="text-2xl animate-[float_3s_ease-in-out_infinite]" style="animation-delay: 0.5s;">üçá</div>
                <div class="text-4xl animate-[float_3s_ease-in-out_infinite]" style="animation-delay: 1s;">ü¶ö</div>
                <div class="text-2xl animate-[float_3s_ease-in-out_infinite]" style="animation-delay: 1.5s;">‚òï</div>
                <div class="text-3xl animate-[float_3s_ease-in-out_infinite]" style="animation-delay: 2s;">üå∫</div>
            </div>

        </main>

        <!-- Bottom Navigation -->
        <nav
            class="fixed bottom-0 left-0 right-0 z-50 border-t-2 border-gold/30 bg-champagne/95 dark:bg-peacock-blue/95 backdrop-blur-xl py-3 shadow-2xl">
            <div class="mx-auto flex max-w-lg justify-around items-center px-2">
                <a class="flex flex-col items-center gap-1 text-peacock-blue/60 dark:text-champagne/60 hover:text-emerald-green dark:hover:text-gold transition-all duration-300 transform hover:scale-110 group"
                    href="index.html">
                    <span
                        class="material-symbols-outlined text-xl group-hover:animate-[heartBeat_0.5s_ease-in-out]">home</span>
                    <span class="text-[10px] font-medium">Home</span>
                </a>

                <a class="flex flex-col items-center gap-1 text-peacock-blue/60 dark:text-champagne/60 hover:text-emerald-green dark:hover:text-gold transition-all duration-300 transform hover:scale-110 group"
                    href="our-story.html">
                    <span
                        class="material-symbols-outlined text-xl group-hover:animate-[heartBeat_0.5s_ease-in-out]">favorite</span>
                    <span class="text-[10px] font-medium">Story</span>
                </a>

                <a class="flex flex-col items-center gap-1 text-peacock-blue/60 dark:text-champagne/60 hover:text-emerald-green dark:hover:text-gold transition-all duration-300 transform hover:scale-110 group"
                    href="events.html">
                    <span
                        class="material-symbols-outlined text-xl group-hover:animate-[heartBeat_0.5s_ease-in-out]">celebration</span>
                    <span class="text-[10px] font-medium">Events</span>
                </a>

                <a class="flex flex-col items-center gap-1 text-peacock-blue/60 dark:text-champagne/60 hover:text-emerald-green dark:hover:text-gold transition-all duration-300 transform hover:scale-110 group"
                    href="venue.html">
                    <span
                        class="material-symbols-outlined text-xl group-hover:animate-[heartBeat_0.5s_ease-in-out]">location_on</span>
                    <span class="text-[10px] font-medium">Venue</span>
                </a>

                <a class="flex flex-col items-center gap-1 text-peacock-blue/60 dark:text-champagne/60 hover:text-emerald-green dark:hover:text-gold transition-all duration-300 transform hover:scale-110 group"
                    href="rsvp.html">
                    <span
                        class="material-symbols-outlined text-xl group-hover:animate-[heartBeat_0.5s_ease-in-out]">check_box</span>
                    <span class="text-[10px] font-medium">RSVP</span>
                </a>

                <a class="flex flex-col items-center gap-1 text-emerald-green dark:text-gold transform scale-110"
                    href="grapevine.html">
                    <div class="bg-emerald-green/10 dark:bg-gold/10 p-2 rounded-full">
                        <span
                            class="material-symbols-outlined text-xl animate-[heartBeat_2s_ease-in-out_infinite]">forum</span>
                    </div>
                    <span class="text-[10px] font-bold">Grapevine</span>
                </a>

                <a class="flex flex-col items-center gap-1 text-peacock-blue/60 dark:text-champagne/60 hover:text-emerald-green dark:hover:text-gold transition-all duration-300 transform hover:scale-110 group"
                    href="memories.html">
                    <span
                        class="material-symbols-outlined text-xl group-hover:animate-[heartBeat_0.5s_ease-in-out]">photo_library</span>
                    <span class="text-[10px] font-medium">Memories</span>
                </a>

                <a class="flex flex-col items-center gap-1 text-peacock-blue/60 dark:text-champagne/60 hover:text-emerald-green dark:hover:text-gold transition-all duration-300 transform hover:scale-110 group"
                    href="find-my-photos.html">
                    <span
                        class="material-symbols-outlined text-xl group-hover:animate-[heartBeat_0.5s_ease-in-out]">face</span>
                    <span class="text-[10px] font-medium">Find Photos</span>
                </a>
            </div>
        </nav>

    </div>

    <script>
        // Global variables
        let currentMessages = [];

        // Array of placeholder avatar URLs
        const avatarUrls = [
            'https://lh3.googleusercontent.com/aida-public/AB6AXuBUcvoKwFyBELqVUW4fgZR-p-l54VFa91RoQL9TCcSfxK3gaNlmD8hn0WcZaE3vxZ9SA8pnwWMZfTlyt5PGfny6Ap2mFOnhx8e4XiGTmkkj4njgstZ93C33rTF_zNQ4D3vlVMpSk8Glmm-t7GCzkE0V3teboRcpYCPFiG_6pjocKTwdv5Xu91iS8kpFRwxUqX95YEgiEgVwqYF_YMXTZLbEPTe_w76a5lP9VROt1BxlR1cVtePYLRGdbfwXdXCE_iBTX-Ag1NEH',
            'https://lh3.googleusercontent.com/aida-public/AB6AXuBEiZZ1wKOZALSe2p-m5PEzwOxSpqhoptXzc6Jfm_uCXZ94Iq3g2tIOp1C7eSj8hB-KGxudDyJ5aJucV76Z9_yWOrE0E3Z6dQ9CbdOrBx5djV_Z3nLNCZforouppHM7gqIv-rHqspj8VMNreO6Bo2HGYGUCVTwIVQipzpx1mS88PcYtqzEacTfBjtZWm9-bMmpBx8m40nlC0XLr1oyh5mUy_iwc50pAUEOLI5iLZcMBz4JZ54z3Kc2D-banYFvO4Mt-18QVSK-r'
        ];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            loadGrapevineMessages();
            setupScrollReveal();
        });

        // Determine API base URL - works both locally and in production
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:8001'
            : '';  // Use relative URL in production (same domain via Nginx)

        // Load grapevine messages
        async function loadGrapevineMessages() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/grapevine`);
                if (response.ok) {
                    currentMessages = await response.json();
                    displayGrapevineMessages();
                }
            } catch (error) {
                console.error('Error loading grapevine messages:', error);
            }
        }

        // Display grapevine messages
        function displayGrapevineMessages() {
            const container = document.getElementById('messages-container');
            if (!container) return;

            // Keep first two hardcoded messages, remove dynamic ones
            const existingMessages = container.querySelectorAll('.message-card');
            for (let i = 2; i < existingMessages.length; i++) {
                existingMessages[i].remove();
            }

            // Add new messages from backend
            currentMessages.forEach(message => {
                const messageElement = createMessageElement(message);
                container.appendChild(messageElement);
            });
        }

        // Create message element
        function createMessageElement(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-card flex items-start gap-4 bg-champagne/40 dark:bg-peacock-blue/40 rounded-xl p-4';

            const timeAgo = getTimeAgo(new Date(message.created_at));
            const avatarIndex = message.id ? (message.id % avatarUrls.length) : Math.floor(Math.random() * avatarUrls.length);
            const avatarUrl = avatarUrls[avatarIndex];

            messageDiv.innerHTML = `
                <img alt="User avatar" class="h-12 w-12 rounded-full border-2 border-gold shadow-lg" src="${avatarUrl}"/>
                <div class="flex-1">
                    <div class="bg-white/80 dark:bg-peacock-blue/80 rounded-xl p-4 shadow-md">
                        <p class="font-body text-sm md:text-base text-peacock-blue dark:text-champagne">${escapeHtml(message.message)}</p>
                    </div>
                    <div class="flex items-center gap-2 mt-2">
                        <span class="font-elegant text-xs font-semibold text-emerald-green dark:text-sage-green">${escapeHtml(message.author_name)}</span>
                        <span class="text-peacock-blue/40 dark:text-champagne/40">‚Ä¢</span>
                        <span class="font-body text-xs text-peacock-blue/60 dark:text-champagne/60">${timeAgo}</span>
                    </div>
                </div>
            `;

            return messageDiv;
        }

        // Submit grapevine message
        async function submitGrapevineMessage() {
            const input = document.getElementById('grapevine-input');
            const message = input.value.trim();

            if (!message) return;

            try {
                const response = await fetch(`${API_BASE_URL}/api/grapevine`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        author_name: 'Velle uncle/auntie'
                    })
                });

                if (response.ok) {
                    input.value = '';
                    loadGrapevineMessages();
                } else {
                    alert('Error posting message. Please try again.');
                }
            } catch (error) {
                console.error('Error submitting message:', error);
                alert('Network error. Please check your connection and try again.');
            }
        }

        // Enter key for grapevine
        document.getElementById('grapevine-input')?.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                submitGrapevineMessage();
            }
        });

        // Scroll reveal setup
        function setupScrollReveal() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.scroll-reveal').forEach(element => {
                observer.observe(element);
            });

            // Reveal first section immediately
            const firstReveal = document.querySelector('.scroll-reveal');
            if (firstReveal) {
                setTimeout(() => firstReveal.classList.add('visible'), 100);
            }
        }

        // Utility functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffMs / (1000 * 60));

            if (diffHours > 0) {
                return `${diffHours} hour${diffHours === 1 ? '' : 's'} ago`;
            } else if (diffMinutes > 0) {
                return `${diffMinutes} minute${diffMinutes === 1 ? '' : 's'} ago`;
            } else {
                return 'just now';
            }
        }

        console.log('üçá The Grapevine Page Loaded');
        console.log('‚òï Spill the tea!');
    </script>

</body>

</html>